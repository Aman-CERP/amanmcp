# v0.1.51

**Released:** 2026-01-06

## Summary

Checkpoint/resume infrastructure for long-running indexing operations, plus critical bug fixes for process hangs and embedding timeouts.

---

## Added

- Add checkpoint infrastructure for resumable indexing
  - `SaveIndexCheckpoint`, `LoadIndexCheckpoint`, `ClearIndexCheckpoint` in metadata store
  - Checkpoint state keys in types.go

- Add `--resume` flag to `init` and `index` commands
  - Resume interrupted indexing from last checkpoint
  - Per-batch (32 chunks) checkpointing during embedding
  - Graceful stop on Ctrl+C with checkpoint preserved

## Fixed

- Fix "context deadline exceeded" timeout regression during embedding (QW-4 regression)
  - `DefaultWarmTimeout` increased from 15s to 60s for subsequent batches
  - Restores pre-QW-4 timeout behavior for warm batches
  - Cold timeout (120s) unchanged for model loading scenarios

- Fix process hangs after indexing error (BUG-044)
  - Add parent context check in OllamaEmbedder retry loop
  - Add timeout to TUI renderer Stop() to prevent hanging
  - Store HTTP transport for proper connection cleanup

## Documentation

- Update README.md version references (0.1.44 â†’ 0.1.50)
- Add `--resume` flag documentation to README command tables
- Add `--resume` flag to first-time user guide
- Add "Interrupted Indexing" troubleshooting section
- Add AC06 (Checkpoint/Resume) to F20 CLI Commands spec

---

## Files Changed

- `cmd/amanmcp/cmd/index.go` - Batched embedding with checkpointing, --resume flag
- `cmd/amanmcp/cmd/init.go` - --resume flag support
- `cmd/amanmcp/cmd/root.go` - Updated runIndexInternal signature
- `internal/embed/ollama.go` - Context check in retry loop, transport cleanup
- `internal/embed/types.go` - Warm timeout increased to 60s
- `internal/ui/tui.go` - Stop() timeout to prevent hanging
- `internal/store/metadata.go` - Checkpoint functions
- `internal/store/types.go` - Checkpoint state keys
- `docs/bugs/BUG-044-process-hangs-after-indexing-error.md` - Bug documentation
- `README.md` - Version and --resume documentation
- `docs/guides/first-time-user-guide.md` - --resume flag and troubleshooting
- `docs/specs/features/F20-cli-commands.md` - AC06 acceptance criteria
