# Version 0.1.15

**Release Date:** 2025-12-30
**Phase:** Phase 2 - MCP Integration (67% complete)

---

## Summary

F16 MCP Server Core implements the Model Context Protocol server foundation that enables AI clients like Claude Code and Cursor to communicate with AmanMCP's hybrid search capabilities.

---

## Added

- F16: MCP Server Core - MCP protocol server implementation
  - Server struct with MCP SDK integration (modelcontextprotocol/go-sdk)
  - NewServer() constructor with dependency injection
  - Tool registration infrastructure (search tool placeholder for F17)
  - Resource listing and reading from MetadataStore
  - Custom error codes (-32001 to -32005) with MapError() mapping
  - Graceful shutdown handling via signals

### CLI Integration

- `amanmcp serve` command for starting MCP server
- `--transport` flag (stdio | sse) - default: stdio
- `--port` flag (for SSE transport) - default: 8765
- Automatic store initialization from `.amanmcp/` directory
- Index required check before server start

### Error Mapping

| Code | Error Type | Description |
|------|------------|-------------|
| -32001 | IndexNotFound | No index available |
| -32002 | EmbeddingFailed | Embedding generation failed |
| -32003 | SearchTimeout | Search timed out |
| -32004 | ToolNotFound | Unknown tool requested |
| -32005 | InvalidParams | Invalid parameters |

---

## Technical Details

### New Files

| File | Lines | Purpose |
|------|-------|---------|
| `internal/mcp/server.go` | ~250 | Core MCP server implementation |
| `internal/mcp/server_test.go` | ~350 | Unit tests (30 tests) |
| `internal/mcp/errors.go` | ~80 | Error mapping utilities |
| `internal/mcp/errors_test.go` | ~100 | Error tests (13 tests) |

### Modified Files

| File | Changes |
|------|---------|
| `cmd/amanmcp/cmd/serve.go` | CLI integration with cobra |
| `go.mod` | Added MCP SDK dependency |

### Quality Metrics

| Metric | Value |
|--------|-------|
| Tests | 31 MCP tests passing |
| Coverage | 66.0% (internal/mcp) |
| Overall Coverage | 79.1% |
| Race Detector | Clean |
| CI Check | PASS |

---

## Dependencies

- `github.com/modelcontextprotocol/go-sdk v1.2.0` - Official MCP Go SDK

---

## Test Scenarios

| Scenario | Status |
|----------|--------|
| TS01: Server creates without error | PASS |
| TS02: Initialize handshake returns server info | PASS |
| TS03: Tools list returns registered tools | PASS |
| TS04: Tool call routing works | PASS |
| TS05: Unknown tool returns proper error | PASS |
| TS06: Invalid params return validation error | PASS |
| TS07: Resources list returns indexed files | PASS |
| TS08: Resource read returns content | PASS |
| TS09: Graceful shutdown | PASS |
| TS10: Concurrent requests (race-safe) | PASS |

---

## What's Next

- F17 (MCP Tools) - Implement search, search_code, search_docs tools

---

*Phase 2: 4/6 features complete (67%)*
*Overall: 16/24 features complete (67%)*
