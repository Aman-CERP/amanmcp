# v0.1.53

**Released:** 2026-01-07

## Summary

Critical fixes for SQLite lock contention and frozen Ctrl+C, plus thermal-aware indexing for sustained GPU workloads on Apple Silicon.

---

## Added

- Thermal-aware indexing for sustained GPU workloads
  - Progressive timeout: Increases timeout as indexing progresses (handles thermal throttling)
  - Inter-batch cooling delay: Optional pause between batches to prevent GPU overheating
  - New config options in `.amanmcp.yaml`:
    - `embeddings.inter_batch_delay`: Pause between batches (e.g., "200ms")
    - `embeddings.timeout_progression`: Timeout increase factor (1.0-3.0)
    - `embeddings.retry_timeout_multiplier`: Retry timeout increase (1.0-2.0)
  - Environment variable overrides: `AMANMCP_INTER_BATCH_DELAY`, `AMANMCP_TIMEOUT_PROGRESSION`, `AMANMCP_RETRY_TIMEOUT_MULTIPLIER`

## Changed

- SQLite connection pool optimized for WAL mode (MaxOpenConns=1, MaxIdleConns=1)
- busy_timeout now set via PRAGMA instead of DSN parameter (DSN was silently ignored)

## Fixed

- Fix `--resume` hanging when `serve` is running (BUG-046)
  - Root cause: SQLite busy_timeout=0 due to DSN parameter being ignored
  - Solution: Set busy_timeout via PRAGMA, add connection pool config

- Fix Ctrl+C frozen during database operations (BUG-047)
  - Root cause: Tight SQLite retry loop blocking signal delivery
  - Solution: Add context checks before DB ops, wrap with timeouts

- Add progress message before embedder init ("Connecting to embedding service...")
  - User sees activity even if Ollama is slow to respond

## Documentation

- Add BUG-046: Resume hangs with SQLite lock contention
- Add BUG-047: Ctrl+C frozen during database operations
- Add RCA-012: SQLite busy_timeout configuration failure
- Add Thermal Management Guide (`docs/guides/thermal-management.md`)

---

## Files Changed

- `internal/store/metadata.go` - Fix busy_timeout via PRAGMA, add connection pool config
- `cmd/amanmcp/cmd/index.go` - Add context checks, timeouts, inter-batch delay
- `internal/embed/ollama.go` - Add progressive timeout, batch tracking
- `internal/embed/ollama_types.go` - Add thermal config fields
- `internal/embed/types.go` - Add thermal constants
- `internal/embed/factory.go` - Add env var parsing for thermal settings
- `internal/config/config.go` - Add thermal settings to EmbeddingsConfig
- `docs/bugs/BUG-046-resume-hangs-sqlite-lock.md` - Bug documentation
- `docs/bugs/BUG-047-ctrl-c-frozen-during-db-ops.md` - Bug documentation
- `docs/postmortems/RCA-012-sqlite-busy-timeout.md` - Root cause analysis
- `docs/guides/thermal-management.md` - User guide for thermal settings
