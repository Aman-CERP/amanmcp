# Version 0.1.34

**Release Date:** 2026-01-02
**Phase:** Maintenance Mode - Concurrency & Timeouts

---

## Summary

Completed v0.1.34 maintenance release focusing on concurrency safety and timeout handling. All 3 items resolved. This release addresses race conditions and adds proper timeout handling for model downloads.

---

## Fixed

### BUG-003: Race Condition in BM25 Load
- **Status:** Already correct (false positive in documentation)
- Implementation at `bm25.go:235-253` already acquires lock before closing
- Added `TestBleveBM25Index_ConcurrentLoadAndSearch` race condition test
- 50 concurrent searchers + 5 concurrent loaders verified safe

### DEBT-002: Watcher Goroutine Cleanup
- **Status:** Already correct (false positive in documentation)
- Implementation at `serve.go:186-281` already uses `errgroup.WithContext()`
- Comment at line 187 confirms: "Uses errgroup for proper goroutine coordination (DEBT-002 fix)"
- Both goroutines use derived context for proper cancellation signaling

### BUG-004: Model Download No Timeout
- **Status:** Fixed - was a real bug
- Added `downloadModelWithTimeout()` wrapper function to `hugot.go`
- Wraps `hugot.DownloadModel()` in goroutine with timeout channel
- Default timeout: 10 minutes (configurable via `ModelDownloadTimeout`)
- Both primary and fallback downloads now use timeout wrapper
- Added 3 tests: `TestDownloadModelWithTimeout_TimeoutReturnsError`, etc.

---

## Technical Details

### Modified Files

| File | Change |
|------|--------|
| `internal/store/bm25_test.go` | Added concurrent load/search race test |
| `internal/embed/hugot.go` | Added `downloadModelWithTimeout()`, updated download calls |
| `internal/embed/hugot_test.go` | Added 3 timeout tests |
| `docs/bugs/BUG-003-bm25-load-race.md` | Status: Resolved |
| `docs/bugs/BUG-004-model-download-timeout.md` | Status: Resolved |
| `docs/tech-debt/DEBT-002-watcher-goroutine-cleanup.md` | Status: Resolved |
| `docs/maintenance/index.md` | v0.1.34 complete |
| `docs/bugs/index.md` | All bugs now resolved |

### Quality Metrics

| Metric | Value |
|--------|-------|
| Tests | All passing |
| Coverage | 72.3% overall |
| Embed Coverage | 66.0% |
| Store Coverage | 73.0% |
| Race Detector | Clean |
| Lint | 0 issues |

---

## What's Next

- v0.1.35: Embedding & Locks (DEBT-008, DEBT-010, DEBT-007, DEBT-006)
- v0.1.36: API Consistency
- v0.1.37: Polish & Cleanup
- Continue 0.1.x releases (v1.0.0 deferred pending full validation)

---

## Maintenance Progress

```
v0.1.33: Resource Safety     ██████████  4/4  (100%) ✓
v0.1.34: Concurrency         ██████████  3/3  (100%) ✓ ← This release
v0.1.35: Embedding & Locks   ░░░░░░░░░░  0/4  (0%)
v0.1.36: API Consistency     ░░░░░░░░░░  0/4  (0%)
v0.1.37: Polish & Cleanup    ░░░░░░░░░░  0/3  (0%)
──────────────────────────────────────────────────────
Total Progress               ████░░░░░░  7/18 (39%)
```

---

*Maintenance Mode: 7/18 items complete (39%)*
