# v0.2.3 - Cross-Encoder Reranking

**Release Date:** 2026-01-11
**Sprint:** 3 (Stabilization + Search Quality)

---

## Summary

Adds cross-encoder reranking via Qwen3-Reranker for improved search relevance. Also fixes daemon logging and index command hanging issues.

---

## Added

- **FEAT-RR1**: Cross-encoder reranking for improved search relevance
  - Add `/rerank` endpoint to MLX server (Qwen3-Reranker models)
  - Add `Reranker` interface and `MLXReranker` client (`internal/search/`)
  - Integrate reranking between RRF fusion and result enrichment
  - Graceful degradation when reranker unavailable
  - Default pool size: 50 candidates, configurable

---

## Fixed

- **BUG-040**: Fix daemon not writing logs and index command hanging
  - Add logging initialization to daemon command (`cmd/amanmcp/cmd/daemon.go`)
  - Add 15s timeout to embedder initialization to prevent indefinite blocking
  - Show specific provider name in progress message during embedder connection
  - Clean up stale serve.pid files at index start

---

## Technical Details

### Reranking Pipeline

```
Search Query
    ↓
BM25 + Vector (parallel)
    ↓
RRF Fusion
    ↓
Cross-Encoder Reranking (NEW) ← Qwen3-Reranker-0.6B
    ↓
Result Enrichment
    ↓
Final Results
```

### Performance

| Metric | Value |
|--------|-------|
| Rerank latency (direct MLX) | ~100-130ms |
| Rerank latency (via MCP) | ~1s |
| Documents reranked | 20 (of 50 pool) |
| Model | Qwen3-Reranker-0.6B |

### Files Changed

| File | Change |
|------|--------|
| `mlx-server/server.py` | Add `/rerank` endpoint |
| `internal/search/reranker.go` | Reranker interface |
| `internal/search/mlx_reranker.go` | Go HTTP client |
| `internal/search/engine.go` | Pipeline integration |
| `internal/search/engine_test.go` | Test coverage |
| `cmd/amanmcp/cmd/daemon.go` | Logging init |
| `cmd/amanmcp/cmd/index.go` | Timeout, progress, PID cleanup |
| `cmd/amanmcp/cmd/serve.go` | Reranker initialization |

---

## Validation

- Tier 1: 75% (9/12) - unchanged
- Tier 2: 75% (3/4) - unchanged
- Negative: 100% (4/4) - unchanged

Note: Reranking is working (confirmed via logs) but doesn't solve the test/implementation file confusion for generic queries. This requires an 8B+ embedding model.

---

## Upgrade Notes

No breaking changes. The reranker is automatically enabled when MLX server is running with Qwen3-Reranker model available.

---

## Related

- RCA-016: Daemon logging and index hang analysis
- SPIKE-001: Cross-encoder research findings
- Sprint 3: Stabilization + Search Quality (100% complete)
