# v0.1.59 - Embedder Validation & Document Consolidation

**Released:** 2026-01-07

---

## Summary

Critical bug fixes for embedder model validation and comprehensive document consolidation. This release ensures index integrity when resuming interrupted operations and prevents mixed embeddings from corrupting the vector index.

## Fixed

- **BUG-053:** Validate embedder model matches checkpoint on resume
  - Added `StateKeyCheckpointEmbedderModel` to store embedder model in checkpoint
  - Resume now fails with clear error if embedder changed since checkpoint was created
  - Prevents mixed-dimension embeddings from corrupting index

- **BUG-054:** Skip reconciliation if embedder model mismatch detected
  - MCP serve now compares current embedder with stored index model
  - Reconciliation (embedding new/changed files) skipped if mismatch
  - Prevents adding incompatible embeddings to existing index

## Documentation

- Archived stale documents: `cld_system_hardening_analysis.md`, `SEARCH-QUALITY-ISSUES.md`
- Merged dogfood state into roadmap `execution-state.json`
- Updated bug/tech-debt indexes to reflect current status
- Updated `docs/context.md` with current project state

## Technical Details

### Files Modified

**Core Changes:**
- `internal/store/types.go` - Added `StateKeyCheckpointEmbedderModel` constant
- `internal/store/metadata.go` - Updated IndexCheckpoint struct, save/load methods
- `cmd/amanmcp/cmd/index.go` - Embedder validation on resume
- `cmd/amanmcp/cmd/serve.go` - Reconciliation embedder check with skip flag

**Documentation:**
- `docs/bugs/index.md` - All bugs now resolved (0 open)
- `docs/roadmap/execution-state.json` - Synced to v0.1.58, added dogfood validation
- `docs/context.md` - Updated project state

### Dogfood Baseline

| Tier | Passed | Total | Status |
|------|--------|-------|--------|
| Tier 1 | 9 | 12 | 75% |
| Tier 2 | 4 | 4 | 100% |
| Negative | 4 | 4 | 100% |

---

## Upgrade Notes

No breaking changes. Existing indexes continue to work. New checkpoints will include embedder model information for safer resume operations.
