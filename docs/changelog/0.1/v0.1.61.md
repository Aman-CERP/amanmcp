# v0.1.61 - Phase C Search Quality (CR-1 + QI-1)

**Release Date:** 2026-01-08

## Summary

Implements Phase C search quality improvements: Contextual Retrieval (CR-1) and Query Expansion (QI-1). Based on Anthropic's research showing 49-67% retrieval error reduction with contextual retrieval.

**Note:** This release includes the implementation infrastructure. Search quality validation is in progress - see session handoff for investigation status.

---

## Added

- **F33 - Contextual Retrieval**: LLM-generated context prepended to chunks at index time for improved semantic search
  - Uses qwen3:0.6b for context generation when available
  - Pattern-based fallback when LLM unavailable (file path + symbol info)
  - Context format: "From file: X. Defines: Y. Purpose: Z."

- **F34 - Query Expansion**: Enhanced BM25 search with code-specific synonyms
  - Bridges vocabulary gap between natural language and code
  - Synonyms: search→Search/Engine, function→func/fn, embedder→Embedder/embed
  - Applied to BM25 only (not vector search per testing results)

## Documentation

- Add ADR-033 (Contextual Retrieval) - LLM context generation strategy
- Add ADR-034 (Query Expansion BM25) - BM25-only expansion approach
- Add F33 feature spec for Contextual Retrieval
- Add F34 feature spec for Query Expansion
- Add session handoff documentation for continuity

## Technical Details

- New files: `internal/index/contextual.go`, `contextual_llm.go`, `contextual_pattern.go`
- Bug fix: Chunks now saved after contextual enrichment (previously only saved before)
- Index time includes contextual generation stage (~2 seconds per file with LLM)

---

## Upgrade Notes

- Requires reindexing to benefit from contextual retrieval
- Run `amanmcp index --force` to rebuild with context
- Ollama with qwen3:0.6b recommended for best context quality
- Pattern-based fallback works without Ollama

## Known Issues

- Search quality regression under investigation (see docs/sessions/2026-01-08-session-handoff.md)
- Code results may rank lower than expected in some queries

---

*Full changelog: [GitHub Releases](https://github.com/Aman-CERP/amanmcp/releases)*
